<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gem.hami.dao.GoodsMapper">
    <!--通过商品ID查询商品-->
    <resultMap id="getGoodsMap" type="Goods">
        <id column="goods_id" property="goodsId"></id>
        <result column="name" property="name"></result>
        <result column="price" property="price"></result>
        <result column="picture" property="picture"></result>
        <result column="location" property="location"></result>
        <result column="release_time" property="releaseTime"></result>
        <result column="phone" property="phone"></result>
        <result column="email" property="email"></result>
        <result column="phone" property="phone"></result>
        <result column="qq" property="qq"></result>
        <result column="remark" property="remark"></result>
        <result column="click_count" property="clickCount"></result>
        <association property="goodsCategory" javaType="GoodsCategory">
            <id column="goods_category_id" property="goodsCategoryId"></id>
            <result column="goods_category_name" property="goodsCategoryName"></result>
        </association>
        <association property="user" javaType="User">
            <id column="user_id" property="userId"></id>
            <result column="nickname" property="nickname"></result>
        </association>
    </resultMap>
    <!--按ID查询商品信息-->
    <select id="selectGoodsById" resultMap="getGoodsMap" parameterType="int">
        select g.*,gc.goods_category_name,u.nickname
        from goods g,goods_category gc,user u,school s
        where g.goods_id=#{_parameter}
        and g.goods_category_id=gc.goods_category_id and g.user_id=u.user_id and u.school_id=s.school_id
    </select>
    <!--按条件查询商品信息-->
    <select id="selectGoodsByCondition" resultType="Goods" parameterType="QueryPojo">
        select g.*,gc.goods_category_name,u.nickname
        from goods g,goods_category gc,user u
        <where>
            g.goods_category_id=gc.goods_category_id
            and g.user_id=u.user_id
            <if test="goodsCategoryId neq null">
                and g.goods_category_id =#{goodsCategoryId}
            </if>
            <if test="name neq null">
                and g.name like "%" #{name} "%"
            </if>
            <if test="name neq null">
                and u.nickname like "%#{name}%"
            </if>
            <if test="schoolId neq null">
                and s.school_id =#{schoolId}
            </if>
            <if test="userId neq null">
                and u.user_id =#{userId}
            </if>
            <if test="time neq null">
                and order BY  g.release_time DESC
            </if>
            <if test="click_counts neq null">
                and order BY  g.click_count DESC
            </if>
        </where>
    </select>

    <!--发布商品-->
    <insert id="insertGoods" parameterType="Goods">
        INSERT into goods (goods_id,name,price,picture,location,release_time,phone,email,qq,remark,click_count,goods_category_id,user_id)
        VALUES (#{goodsId},#{name},#{price},#{picture},#{location},#{releaseTime},#{phone},#{email},#{qq},#{remark},0,#{goodsCategoryId},#{userId})
    </insert>

    <!--商品推荐-->
    <select id="selectRecommend" resultType="Goods">
        SELECT * FROM  goods g where g.goods_category_id=
        (SELECT g.goods_category_id from goods g where g.goods_id=#{goodsId})
    </select>

    <!--修改商品信息-->
    <update id="updateGoodsByCondition" parameterType="Goods">
        UPDATE goods set name=#{name},price=#{price},location=#{location},phone=#{phone},click_count=#{clickCount}
        where goods_id=#{goodsId}
    </update>

    <!--删除商品-->
    <delete id="deleteGoods" parameterType="int">
        delete from goods where goods_id=#{_parameter}
    </delete>
</mapper>